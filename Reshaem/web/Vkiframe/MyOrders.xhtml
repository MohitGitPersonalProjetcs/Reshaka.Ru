<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core">


    <body>
        <ui:composition template="#{request.contextPath}/Vkiframe/templates/template.xhtml">

            <ui:define name="vk_tabs">
                <ui:include src="#{request.contextPath}/Vkiframe/templates/tabs.xhtml">
                    <ui:param name="tab_no" value="2" />
                </ui:include>
            </ui:define>

            <ui:define name="content">

                <h3>
                    Здесь вы можете управлять своими заказами
                </h3>

                <table class="wikiTable" >
                    <thead>
                        <tr>
                            <th scope="col">
                                ID
                            </th>
                            <th scope="col">
                                Статус
                            </th>
                            <th scope="col">
                                Цена
                            </th>
                            <th scope="col">
                                Дата
                            </th>
                            <th scope="col">
                                Теги
                            </th>
                            <th scope="col">
                                Тип
                            </th>
                        </tr>
                    </thead>
                    <tbody>

                        <c:forEach items="#{showOrdersBeanVK.allOrders}" var="order">

                            <tr id="qwe" class="main" >
                                <td class="expand">
                                    <a href="javascript:void()" style="color: black; text-decoration: none;">
                                        #{order.id}
                                    </a>
                                </td>

                                <td>
                                    <span class="#{orderUtilsBean.orderStatus(order.id)}">
                                        #{orderUtilsBean.russianOrderStatus(order.id)}

                                    </span>
                                </td>

                                <td>
                                    #{order.price}
                                </td>

                                <td>
                                    <h:outputText  value="#{order.deadline}">
                                        <f:convertDateTime pattern="dd.MM.yyyy HH:mm" />
                                    </h:outputText>
                                </td>

                                <td>
                                    #{order.tags}
                                </td>

                                <td style="color: #2B587A;">
                                    <c:if test="#{order.type == 0}">
                                        Оффлайн заказ
                                    </c:if>
                                    <c:if test="#{order.type == 1}">
                                        Онлайн-помощь
                                    </c:if>

                                </td>
                            </tr>

                            <tr  class="sab" style="margin: 0; padding: 0px;   display: none;" >
                                <td colspan="6" style="padding: 0px;">
                                    <div id="spanid#{order.id}" style="display: table-row; border-collapse: collapse; text-align: justify; vertical-align: inherit; height: 150px;">
                                        <!--                                        <h:panelGrid columns="2">-->
                                        <h:outputLabel class="pedit_label" style="width: 120px;" value="ID" />
                                        <h:outputLabel value="#{order.id}" />
                                        <br/>

                                        <h:panelGroup rendered="#{ ( order.status == 1) or (order.status==11)}" >
                                            <h:outputLabel value="Предложили помощь: " class="pedit_label" style="vertical-align: top; width: 120px;" />
                                            <div style="display: inline-block;  color: #0000e5;">
                                                <div style=" overflow: auto; max-height: 50px; width: 300px; display:inline-block; margin-top:4px; ">
                                                    <c:forEach items="#{orderUtilsBean.offersByOrderId(order.id)}" var="offer">
                                                        <h:link outcome="#{request.contextPath}/Vkiframe/profile.xhtml" value="#{orderUtilsBean.loginById(offer.userId)}">
                                                            <f:param name="id" value="#{offer.userId}"/>
                                                        </h:link>, 
                                                    </c:forEach>




                                                </div>
                                                <div style=" text-align: left;">
                                                    <a href="javascript:void();" onclick="$('#rated_span#{order.id} div').css('display','table-row'); $('#spanid#{order.id}').css('display', 'none');">
                                                        Выбрать
                                                    </a>
                                                </div>
                                            </div>
                                        </h:panelGroup>
                                    </div>
                                    <h:panelGroup id="rated_span#{order.id}" style=" max-height: 150px; overflow: auto; display:block;" rendered="#{ ( order.status == 1) or (order.status==11)}">
                                        <div style="display: none; text-align: left;" >
                                            <h3>
                                                Выберите решающего
                                            </h3>
                                            <!--                                        <table>
                                                                                        <tr>-->
                                            <!--                                                <span style="display: inline-block; width: 300px;">-->
                                            <table style=" margin-left: 5px;" class="wikiTable">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">
                                                            Решака
                                                        </th>
                                                        <th scope="col">
                                                            Предложенная стоимость
                                                        </th>
                                                        <th scope="col">

                                                        </th>
                                                    </tr>
                                                </thead>
                                                <c:forEach items="#{orderUtilsBean.offersByOrderId(order.id)}" var="off">
                                                    <tr >
                                                        <td>
                                                            <h:link outcome="#{request.contextPath}/Vkiframe/profile.xhtml" value="#{orderUtilsBean.loginById(off.userId)}">
                                                                <f:param name="id" value="#{offer.userId}"/>
                                                            </h:link>
                                                        </td>
                                                        <td>
                                                            #{off.price}
                                                        </td>
                                                        <td>
                                                            <a href="javascript:void();" style="text-decoration: none;">
                                                                Выбрать
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </c:forEach>
                                            </table>
                                            <!--                                                </span>-->

                                            <span style="display: inline-block; width:250px;">
                                                
                                            </span>
                                        </div>
                                        <!--                                            </tr>
                                                                                </table>-->

                                    </h:panelGroup>

                                </td>
                            </tr>

                        </c:forEach>

                        <script>
                            $("td").click(function() {
                                $(this).parents("tr.main").nextAll("tr.sab").hide();
                                $(this).parents("tr.main").prevAll("tr.sab").hide();
                                 
                                $(this).parents("tr.main").nextUntil("tr.main").toggle("slow");
                            });
                            //                            $("td div span div div a").click(function(){
                            //                                $(this).css('color', 'yellow');
                            //                            });

                            
                            
                            
                        </script>

                    </tbody>
                </table>


                <div style="text-align: right;">
                    <h:panelGroup>
                        <h:form style="margin-right: 20px;">
                            <h:commandButton  value="←" rendered="#{showOrdersBeanVK.page > 0}" class="vkNextButton" actionListener="#{showOrdersBeanVK.prevPage()}" />
                            <h:commandButton value="→" rendered="#{showOrdersBeanVK.shouldShowNextButton()}" class="vkNextButton" actionListener="#{showOrdersBeanVK.nextPage()}" />
                        </h:form>
                    </h:panelGroup>
                </div>

            </ui:define>

            <ui:define name="footer">
                <ui:include src="#{request.contextPath}/Vkiframe/templates/footer.xhtml" />
            </ui:define>

        </ui:composition>

    </body>
</html>
